<!DOCTYPE html>
<html lang="zh-Hant" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>æ—…éŠæ‰‹å¸³ãƒ»Our Travel Diary</title>

  <!-- PWA -->
  <link rel="manifest" href="data:application/manifest+json,{
    'name': 'æ—…éŠæ‰‹å¸³',
    'short_name': 'æ—…éŠæ‰‹å¸³',
    'start_url': '.',
    'display': 'standalone',
    'background_color': '#FFF9E3',
    'theme_color': '#FFD1DC',
    'icons': [{'src':'icon.png','sizes':'192x192','type':'image/png'}, {'src':'icon.png','sizes':'512x512','type':'image/png'}]
  }">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@300;400;500;700&display=swap" rel="stylesheet">

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Zen Maru Gothic', 'system-ui', 'sans-serif'] },
          colors: {
            sakura: '#FFD1DC',
            beige:  '#FFF9E3',
            mizuiro:'#B0E0E6',
            cocoa:  '#D2B48C',
          },
          borderRadius: { '4xl': '2rem', '5xl': '2.5rem' },
        }
      }
    }
  </script>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <style>
    body { background: #FFF9E3; overscroll-behavior: none; }
    .card-shadow { box-shadow: 0 10px 25px -5px rgba(0,0,0,0.07); }
  </style>
</head>
<body class="min-h-screen font-sans antialiased">

  <div id="app" class="relative">

    <!-- é é¦–èƒŒæ™¯ -->
    <header class="relative h-80 md:h-96 bg-cover bg-center" :style="{ backgroundImage: `url('${splash || 'https://images.unsplash.com/photo-1558445034-055296cc0aca?auto=format&fit=crop&q=80&w=1200'}')` }">
      <div class="absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-beige/70"></div>
      <div class="absolute inset-x-0 bottom-0 h-20 bg-gradient-to-t from-beige to-transparent"></div>
    </header>

    <!-- ä¸»è¦å…§å®¹ - è² é‚Šè·å‘ä¸Š -->
    <main class="-mt-28 md:-mt-32 mx-4 md:mx-auto max-w-3xl relative z-10 pb-32">
      <div class="bg-white/85 backdrop-blur-md rounded-4xl shadow-2xl p-5 md:p-8 border border-sakura/40">

        <!-- Tabs (æµ®å‹• â†’ sticky) -->
        <nav :class="[
          'fixed z-50 transition-all duration-300 ease-in-out',
          isScrolled
            ? 'top-3 left-1/2 -translate-x-1/2 w-auto'
            : 'bottom-6 right-6 md:bottom-8 md:right-10'
        ]">
          <div class="flex bg-white/90 backdrop-blur-lg rounded-full shadow-xl px-2 py-2 border border-sakura/30">
            <button v-for="tab in tabs" :key="tab.id"
              @click="currentTab = tab.id"
              :class="['flex items-center px-4 py-3 md:px-6 text-cocoa transition-colors',
                      currentTab === tab.id ? 'text-sakura font-medium' : 'hover:text-sakura/80']"
            >
              <i :class="tab.icon" class="text-xl md:text-2xl"></i>
              <span class="hidden md:inline ml-2 text-sm md:text-base">{{ tab.label }}</span>
            </button>
          </div>
        </nav>

        <!-- å…§å®¹å€åŸŸ -->
        <div class="mt-6 md:mt-4">
          <h1 class="text-3xl md:text-4xl font-bold text-center text-sakura mb-6 tracking-wide">æ—…éŠæ‰‹å¸³</h1>

          <!-- è¡Œç¨‹ Tab -->
          <div v-if="currentTab === 'schedule'" class="space-y-6">
            <div v-for="(day, date) in groupedSchedules" :key="date" class="space-y-4">
              <h2 class="text-xl font-medium text-cocoa/90 pl-2 border-l-4 border-sakura/60">{{ date }}</h2>
              <draggable v-model="day.items" item-key="id" @end="onDragEnd(date)"
                :animation="200" :ghost-class="'opacity-50'" handle=".drag-handle">
                <template #item="{ element: item }">
                  <div class="relative bg-white rounded-2xl p-4 card-shadow border border-sakura/20 hover:border-sakura/40 transition-all duration-200"
                    :class="{ 'scale-105 shadow-2xl z-20': draggingItemId === item.id }">
                    <div class="flex items-start gap-3">
                      <button class="drag-handle cursor-move text-cocoa/40 hover:text-cocoa mt-1">
                        <i class="fas fa-grip-vertical text-xl"></i>
                      </button>
                      <div class="flex-1">
                        <div class="font-medium text-lg" :class="item.type === 'transport' ? 'text-mizuiro' : 'text-cocoa'">
                          {{ item.type === 'transport' ? (item.from + ' â†’ ' + item.to) : item.title }}
                        </div>
                        <div class="text-sm text-cocoa/70 mt-1">
                          {{ formatTime(item.start_time) }} â€” {{ formatTime(item.end_time) }}
                          <span class="ml-2 opacity-60">({{ item.duration }})</span>
                        </div>
                        <div v-if="item.location" class="text-sm text-sakura mt-1">
                          <i class="fas fa-map-marker-alt mr-1"></i>{{ item.location }}
                        </div>
                      </div>
                    </div>
                  </div>
                </template>
              </draggable>
            </div>

            <!-- ç„¡è³‡æ–™æç¤º -->
            <div v-if="!Object.keys(groupedSchedules).length" class="text-center py-12 text-cocoa/60">
              é‚„æ²’æœ‰ä»»ä½•è¡Œç¨‹å–”ï½é»æ“Šå³ä¸‹ + ä¾†æ–°å¢å§ ğŸŒ¸
            </div>
          </div>

          <!-- å…¶ä»– Tab ä½”ä½ -->
          <div v-else class="text-center py-20 text-cocoa/50">
            <i :class="tabs.find(t => t.id === currentTab)?.icon" class="text-6xl mb-4 block"></i>
            <p class="text-xl">{{ tabs.find(t => t.id === currentTab)?.label }} åŠŸèƒ½é–‹ç™¼ä¸­...</p>
          </div>
        </div>
      </div>
    </main>

    <!-- FAB -->
    <button @click="alert('æ–°å¢è¡Œç¨‹åŠŸèƒ½å³å°‡å¯¦ä½œï½')" 
      class="fixed bottom-28 right-8 z-40 w-16 h-16 rounded-full bg-sakura text-white shadow-2xl flex items-center justify-center text-3xl hover:bg-sakura/90 active:scale-95 transition transform">
      <i class="fas fa-plus"></i>
    </button>

  </div>

  <!-- ä¾åºè¼‰å…¥å¿…è¦ library -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vuedraggable@next/dist/vuedraggable.umd.min.js"></script>

  <script>
    const { createApp, ref, computed, watch, onMounted } = Vue;

    createApp({
      setup() {
        const currentTab = ref('schedule');
        const isScrolled = ref(false);
        const splash = ref(''); // ä½ å¯ä»¥ä¹‹å¾Œæ”¹æˆæœ¬åœ°æª”æ¡ˆ './splash.jpeg'

        // å‡è³‡æ–™ - æ¨¡æ“¬ localStorage
        const schedules = ref([]);

        const tabs = [
          { id: 'schedule', label: 'è¡Œç¨‹', icon: 'fas fa-calendar-days' },
          { id: 'nav',       label: 'å°èˆª', icon: 'fas fa-map' },
          { id: 'vouchers',  label: 'æ†‘è­‰', icon: 'fas fa-ticket' },
          { id: 'list',      label: 'æ¸…å–®', icon: 'fas fa-list-check' },
          { id: 'expense',   label: 'è¨˜å¸³', icon: 'fas fa-yen-sign' },
        ];

        // è¼‰å…¥ localStorage
        onMounted(() => {
          const saved = localStorage.getItem('travelDiarySchedules');
          if (saved) {
            schedules.value = JSON.parse(saved);
          } else {
            // é è¨­å‡è³‡æ–™
            schedules.value = [
              { id: 1, day_date: '2025-04-10', type: 'activity', title: 'æ·ºè‰å¯ºåƒæ‹œ', start_time: '09:30', duration: '90', end_time: '11:00', location: 'æ·ºè‰å¯º' },
              { id: 2, day_date: '2025-04-10', type: 'transport', from: 'æ·ºè‰ç«™', to: 'ä¸Šé‡ç«™', start_time: '11:15', duration: '15', end_time: '11:30' },
              { id: 3, day_date: '2025-04-10', type: 'activity', title: 'ä¸Šé‡å…¬åœ’è³æ«»', start_time: '11:45', duration: '120', end_time: '13:45', location: 'ä¸Šé‡å…¬åœ’' },
              { id: 4, day_date: '2025-04-11', type: 'activity', title: 'æ™´ç©ºå¡”', start_time: '10:00', duration: '180', end_time: '13:00', location: 'æ±äº¬æ™´ç©ºå¡”' },
            ];
            saveToLocal();
          }

          window.addEventListener('scroll', () => {
            isScrolled.value = window.scrollY > 220;
          });
        });

        const saveToLocal = () => {
          localStorage.setItem('travelDiarySchedules', JSON.stringify(schedules.value));
        };

        const groupedSchedules = computed(() => {
          const groups = {};
          schedules.value.forEach(item => {
            if (!groups[item.day_date]) groups[item.day_date] = { items: [] };
            groups[item.day_date].items.push(item);
          });
          return groups;
        });

        const onDragEnd = (date) => {
          // é€™è£¡ä¹‹å¾Œæœƒå‘¼å« Time Engine é‡æ–°è¨ˆç®—æ™‚é–“éˆ
          saveToLocal();
          console.log('æ‹–æ‹½çµæŸï¼Œå·²å„²å­˜æ’åº', date);
        };

        const formatTime = (time) => time ? time.slice(0,5) : '--:--';

        return {
          currentTab,
          isScrolled,
          tabs,
          schedules,
          groupedSchedules,
          onDragEnd,
          formatTime,
          splash,
          draggingItemId: ref(null), // ä¹‹å¾Œç”¨ä¾†åšè¦–è¦ºåé¥‹
        };
      }
    }).component('draggable', vuedraggable).mount('#app');

    // æœ€å¾Œæ¨™è¨˜
    document.write('<footer class="text-center text-sm text-cocoa/60 py-12 fixed bottom-0 left-0 right-0 bg-beige/80 backdrop-blur-sm z-30">ğŸŒ¸ Tiffany & Benjamin ğŸŒ¸</footer>');
  </script>

</body>
</html>
