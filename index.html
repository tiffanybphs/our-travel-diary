<!DOCTYPE html>
<html lang="zh-TW" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>æ—…éŠæ‰‹å¸³ãƒ»Our Travel Diary</title>
  
  <!-- PWA åŸºæœ¬è¨­å®š -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#FFD1DC">
  <link rel="apple-touch-icon" href="assets/icon.png">

  <!-- Google Font: Zen Maru Gothic -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@300;400;500;700&display=swap" rel="stylesheet">

  <!-- Font Awesome 6 Free -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['"Zen Maru Gothic"', 'sans-serif'],
          },
          colors: {
            'sakura': '#FFD1DC',
            'beige': '#FFF9E3',
            'aqua': '#B0E0E6',
            'cocoa': '#8B7355',
          },
          borderRadius: {
            '4xl': '2.5rem',
          }
        }
      }
    }
  </script>

  <!-- Vue 3 CDN -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
</head>
<body class="bg-beige min-h-screen text-cocoa antialiased">

  <div id="app"></div>

  <!-- é€™è£¡æ”¾ main.js å…§å®¹ï¼Œæˆ–æ˜¯ç¨ç«‹æª”æ¡ˆå¼•å…¥ -->
  <script type="module">
  const { createApp, ref, computed, watch, onMounted } = Vue;

  // å¼•å…¥ vue-draggable-next (Vue 3 ç›¸å®¹ç‰ˆ)
  // æ³¨æ„ï¼šé€™æ˜¯ UMD ç‰ˆæœ¬ï¼Œå¯ç›´æ¥åœ¨ç€è¦½å™¨ä½¿ç”¨
  // https://cdn.jsdelivr.net/npm/vue-draggable-next@2.2.1/dist/vuedraggable.umd.min.js
</script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue-draggable-next@2.2.1/dist/vuedraggable.umd.min.js"></script>

<script type="module">
  // ------------------- Header Component (ä¿æŒä¸è®Š) -------------------
  const Header = {
    template: `...` // ä¿æŒåŸæ¨£ï¼Œçœç•¥ä»¥ç¯€çœç©ºé–“
  };

  // ------------------- FloatingTabs (ä¿æŒä¸è®Š) -------------------
  const FloatingTabs = {
    // ... ä¿æŒåŸæ¨£
  };

  // ================== æ–°å¢ï¼šSchedule Tab å…§å®¹ ==================
  const ScheduleTab = {
    components: {
      draggable: window.vuedraggable // å¾å…¨åŸŸå–å¾—
    },
    setup() {
      // å‡è³‡æ–™ï¼šå¯ä¹‹å¾Œæ›æˆ Supabase ä¾†çš„è³‡æ–™
      const dailyPlan = ref([
        {
          id: 1,
          type: 'activity',          // 'activity' æˆ– 'transport'
          startTime: '09:00',
          duration: 150,             // åˆ†é˜
          title: 'æ·ºè‰å¯ºåƒæ‹œ',
          location: 'æ·ºè‰å¯º',
          note: 'è¨˜å¾—æŠ½ç±¤ï¼',
          transport: null
        },
        {
          id: 2,
          type: 'transport',
          startTime: '11:30',
          duration: 40,
          title: 'åœ°éµç§»å‹•',
          location: 'æ·ºè‰ â†’ æ±äº¬æ™´ç©ºå¡”',
          note: 'éŠ€åº§ç·š â†’ éƒ½ç‡Ÿæ·ºè‰ç·š',
          transport: {
            from: 'æ·ºè‰ç«™',
            to: 'æŠ¼ä¸Šç«™',
            modes: ['åœ°éµ', 'æ­¥è¡Œ']
          }
        },
        {
          id: 3,
          type: 'activity',
          startTime: '12:10',
          duration: 90,
          title: 'æ™´ç©ºå¡”å±•æœ›å° + åˆé¤',
          location: 'æ±äº¬æ™´ç©ºå¡” Solamachi',
          note: 'åƒé›·é–€ç« é­šç‡’',
          transport: null
        },
        {
          id: 4,
          type: 'activity',
          startTime: '15:00',
          duration: 120,
          title: 'ä¸Šé‡å…¬åœ’æ«»èŠ±æ•£æ­¥',
          location: 'ä¸Šé‡å…¬åœ’',
          note: 'å¦‚æœæ˜¥å¤©æœ‰æ«»èŠ±å°±å¤ªæ£’äº†',
          transport: null
        }
      ]);

      // è¨ˆç®—çµæŸæ™‚é–“ï¼ˆæ ¼å¼ HH:MMï¼‰
      const getEndTime = (start, duration) => {
        const [h, m] = start.split(':').map(Number);
        const totalMin = h * 60 + m + duration;
        const endH = Math.floor(totalMin / 60).toString().padStart(2, '0');
        const endM = (totalMin % 60).toString().padStart(2, '0');
        return `\( {endH}: \){endM}`;
      };

      // ç•¶æŸé …æ”¹è®Š duration æˆ–é †åºæ™‚ï¼Œè‡ªå‹•æ›´æ–°å¾ŒçºŒé–‹å§‹æ™‚é–“
      const updateTimes = () => {
        let currentTime = null;
        dailyPlan.value.forEach((item, index) => {
          if (index === 0) {
            // ç¬¬ä¸€ç­†ä¿æŒåŸé–‹å§‹æ™‚é–“
            currentTime = item.startTime;
          } else {
            // å¾ŒçºŒé è¨­æ¥çºŒå‰ä¸€ç­†çµæŸæ™‚é–“
            item.startTime = currentTime;
          }
          const end = getEndTime(currentTime, item.duration);
          currentTime = end;
        });
      };

      // ç›£è½ duration è®ŠåŒ– & é †åºè®ŠåŒ–å¾Œé‡æ–°è¨ˆç®—
      watch(dailyPlan, updateTimes, { deep: true });

      // åˆæ¬¡è¼‰å…¥ä¹ŸåŸ·è¡Œä¸€æ¬¡
      onMounted(updateTimes);

      // æ–°å¢ä¸€ç­†ï¼ˆç°¡å–®ç¤ºç¯„ï¼‰
      const addItem = (type) => {
        const lastEnd = dailyPlan.value.length > 0 
          ? getEndTime(dailyPlan.value[dailyPlan.value.length-1].startTime, dailyPlan.value[dailyPlan.value.length-1].duration)
          : '09:00';

        dailyPlan.value.push({
          id: Date.now(),
          type,
          startTime: lastEnd,
          duration: type === 'activity' ? 90 : 30,
          title: type === 'activity' ? 'æ–°æ´»å‹•' : 'æ–°äº¤é€š',
          location: '',
          note: '',
          transport: type === 'transport' ? { from: '', to: '', modes: [] } : null
        });
      };

      return {
        dailyPlan,
        getEndTime,
        addItem
      };
    },
    template: `
      <div class="space-y-5">
        <!-- æ“ä½œåˆ— -->
        <div class="flex gap-3 justify-center mb-6">
          <button 
            @click="addItem('activity')"
            class="px-5 py-2 bg-sakura text-white rounded-full shadow-md hover:bg-sakura/90 transition"
          >
            <i class="fa-solid fa-plus mr-1"></i> æ–°å¢æ´»å‹•
          </button>
          <button 
            @click="addItem('transport')"
            class="px-5 py-2 bg-aqua text-white rounded-full shadow-md hover:bg-aqua/90 transition"
          >
            <i class="fa-solid fa-route mr-1"></i> æ–°å¢äº¤é€š
          </button>
        </div>

        <!-- æ™‚é–“è»¸ä¸»é«”ï¼Œä½¿ç”¨ draggable åŒ…ä½ -->
        <draggable 
          v-model="dailyPlan" 
          item-key="id"
          tag="div"
          class="space-y-4"
          handle=".drag-handle"
          animation="200"
          @end="() => {}"  <!-- å¯åœ¨æ­¤æ”¾æ’åºå®Œæˆå¾Œçš„é¡å¤–é‚è¼¯ -->
        >
          <template #item="{element, index}">
            <div 
              class="relative rounded-2xl overflow-hidden shadow-md border transition-all"
              :class="element.type === 'activity' 
                ? 'bg-gradient-to-br from-sakura/10 to-sakura/5 border-sakura/30' 
                : 'bg-gradient-to-br from-aqua/10 to-aqua/5 border-aqua/30'"
            >
              <!-- æ‹–æ‹½æŠŠæ‰‹ -->
              <div class="drag-handle absolute left-0 top-0 bottom-0 w-10 flex items-center justify-center cursor-move text-cocoa/40 hover:text-cocoa/70">
                <i class="fa-solid fa-grip-vertical text-xl"></i>
              </div>

              <div class="pl-14 pr-5 py-4">
                <!-- æ™‚é–“å€ -->
                <div class="flex justify-between items-center mb-2">
                  <div class="text-xl font-bold text-cocoa">
                    {{ element.startTime }} - {{ getEndTime(element.startTime, element.duration) }}
                  </div>
                  <span 
                    class="px-3 py-1 rounded-full text-sm font-medium"
                    :class="element.type === 'activity' ? 'bg-sakura/20 text-sakura' : 'bg-aqua/20 text-aqua'"
                  >
                    {{ element.type === 'activity' ? 'æ™¯é»/æ´»å‹•' : 'äº¤é€š' }}
                  </span>
                </div>

                <!-- æ¨™é¡Œ & åœ°é» -->
                <h3 class="font-bold text-lg mb-1">{{ element.title }}</h3>
                <p class="text-cocoa/80 mb-2">{{ element.location }}</p>

                <!-- äº¤é€šå°ˆå±¬é¡¯ç¤º -->
                <div v-if="element.type === 'transport' && element.transport" class="mt-2 text-sm bg-white/40 rounded-lg p-2">
                  <div class="flex items-center gap-2">
                    <i class="fa-solid fa-location-dot text-aqua"></i>
                    <span>{{ element.transport.from }}</span>
                    <i class="fa-solid fa-arrow-right-long text-cocoa/60"></i>
                    <span>{{ element.transport.to }}</span>
                  </div>
                  <div class="mt-1 text-cocoa/70">
                    æ–¹å¼ï¼š{{ element.transport.modes.join(' â†’ ') || 'æœªæŒ‡å®š' }}
                  </div>
                </div>

                <!-- æŒçºŒæ™‚é–“èª¿æ•´ -->
                <div class="mt-3 flex items-center gap-3 text-sm">
                  <label class="text-cocoa/70">æŒçºŒï¼š</label>
                  <input 
                    v-model.number="element.duration" 
                    type="number" 
                    min="5" 
                    class="w-20 px-2 py-1 border border-cocoa/30 rounded-lg text-center focus:outline-none focus:border-sakura"
                  >
                  <span class="text-cocoa/70">åˆ†é˜</span>
                </div>

                <!-- å‚™è¨» -->
                <textarea 
                  v-model="element.note"
                  placeholder="å‚™è¨»..."
                  class="mt-3 w-full px-3 py-2 text-sm border border-cocoa/20 rounded-lg focus:outline-none focus:border-sakura/50 bg-white/40"
                  rows="2"
                ></textarea>
              </div>
            </div>
          </template>
        </draggable>

        <!-- æ²’æœ‰è³‡æ–™æ™‚çš„æç¤º -->
        <div v-if="dailyPlan.length === 0" class="text-center py-10 text-cocoa/50">
          é‚„æ²’æœ‰ä»»ä½•è¡Œç¨‹å–”ï½ å¿«ä¾†æ–°å¢å§ï¼
        </div>
      </div>
    `
  };

  // ------------------- App ä¸»å…ƒä»¶ -------------------
  const App = {
    components: { Header, FloatingTabs, ScheduleTab },
    setup() {
      const activeTab = ref('schedule');
      return { activeTab };
    },
    template: `
      <div class="relative pb-24">
        <Header />

        <main class="-mt-20 mx-4 rounded-4xl bg-white/90 backdrop-blur-sm shadow-xl border border-sakura/20 overflow-hidden min-h-[calc(100vh-38vh+5rem)]">
          <div class="p-5">
            <h2 class="text-2xl font-bold text-cocoa mb-4">
              {{ activeTab === 'schedule' ? 'ä»Šæ—¥è¡Œç¨‹' : activeTab + ' é é¢ï¼ˆé–‹ç™¼ä¸­ï¼‰' }}
            </h2>
            
            <ScheduleTab v-if="activeTab === 'schedule'" />
            
            <!-- å…¶ä»– tab ä¹‹å¾Œå†å¯¦ä½œ -->
            <div v-else class="text-center py-20 text-cocoa/50">
              è©²åŠŸèƒ½æ­£åœ¨åŠªåŠ›é–‹ç™¼ä¸­ ğŸŒ¸
            </div>
          </div>
        </main>

        <FloatingTabs v-model:activeTab="activeTab" />
        
        <footer class="text-center text-cocoa/50 py-8 text-sm">
          ğŸŒ¸ Tiffany & Benjamin ğŸŒ¸
        </footer>
      </div>
    `
  };

  createApp(App).mount('#app');
</script>
    // main.js å…§å®¹ç›´æ¥å¯«åœ¨é€™è£¡ï¼ˆæˆ–ä¹‹å¾Œæ”¹æˆ <script src="main.js" type="module"></script>ï¼‰
    const { createApp, ref, computed, onMounted, watch } = Vue;

    // ------------------- Header Component -------------------
    const Header = {
      template: `
        <div class="relative h-[38vh] min-h-[260px] w-full overflow-hidden">
          <!-- èƒŒæ™¯åœ– -->
          <div class="absolute inset-0">
            <img 
              src="https://images.unsplash.com/photo-1558591710-4b4a1ae0f04d?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80" 
              alt="æ«»èŠ±èƒŒæ™¯" 
              class="object-cover w-full h-full brightness-95"
            >
            <div class="absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-beige/70"></div>
          </div>
          
          <!-- æ¨™é¡Œ -->
          <div class="absolute bottom-6 left-5 right-5 text-center z-10">
            <h1 class="text-4xl font-bold text-white drop-shadow-lg">æ—…éŠæ‰‹å¸³</h1>
            <p class="text-white/90 mt-1 text-lg drop-shadow">èˆ‡æ«»èŠ±ä¸€èµ·è¨˜éŒ„æ—…ç¨‹</p>
          </div>
        </div>
      `
    };

    // ------------------- Floating â†’ Sticky Tabs -------------------
    const FloatingTabs = {
      props: ['activeTab'],
      emits: ['update:activeTab'],
      setup(props, { emit }) {
        const isSticky = ref(false);
        const tabs = ref([
          { id: 'schedule', label: 'è¡Œç¨‹', icon: 'calendar-days' },
          { id: 'map',      label: 'å°èˆª', icon: 'map-location' },
          { id: 'vouchers', label: 'æ†‘è­‰', icon: 'ticket' },
          { id: 'list',     label: 'æ¸…å–®', icon: 'list-check' },
          { id: 'expense',  label: 'è¨˜å¸³', icon: 'yen-sign' },
        ]);

        onMounted(() => {
          window.addEventListener('scroll', handleScroll);
          handleScroll(); // åˆæ¬¡åˆ¤æ–·
        });

        const handleScroll = () => {
          // ç•¶æ²é Header é«˜åº¦ç´„ 70% æ™‚åˆ‡æ› sticky
          const headerHeight = window.innerHeight * 0.38;
          isSticky.value = window.scrollY > headerHeight * 0.7;
        };

        return {
          tabs,
          isSticky,
          activeTab: computed({
            get: () => props.activeTab,
            set: (val) => emit('update:activeTab', val)
          })
        };
      },
      template: `
        <nav 
          :class="[
            'z-50 transition-all duration-300',
            isSticky 
              ? 'fixed top-0 left-0 right-0 bg-beige/95 backdrop-blur-md shadow-sm border-b border-sakura/30'
              : 'absolute bottom-[-3.2rem] right-5 flex justify-end'
          ]"
        >
          <div 
            :class="[
              isSticky 
                ? 'flex w-full justify-around py-3 px-4'
                : 'inline-flex bg-white/80 backdrop-blur-lg rounded-full shadow-lg px-2 py-3 gap-2 border border-sakura/40'
            ]"
          >
            <button 
              v-for="tab in tabs" 
              :key="tab.id"
              @click="activeTab = tab.id"
              :class="[
                'flex flex-col items-center px-3 py-1 rounded-xl transition-colors',
                activeTab === tab.id 
                  ? 'text-sakura bg-sakura/10' 
                  : 'text-cocoa/70 hover:text-sakura hover:bg-sakura/5'
              ]"
            >
              <i :class="'fa-solid fa-' + tab.icon + ' text-xl mb-1'"></i>
              <span class="text-xs font-medium">{{ tab.label }}</span>
            </button>
          </div>
        </nav>
      `
    };

    // ------------------- App ä¸»å…ƒä»¶ -------------------
    const App = {
      components: { Header, FloatingTabs },
      setup() {
        const activeTab = ref('schedule');

        return { activeTab };
      },
      template: `
        <div class="relative pb-24">
          <Header />

          <!-- è² é‚Šè· + åœ“è§’ä¸»å…§å®¹å€ -->
          <main class="-mt-20 mx-4 rounded-4xl bg-white/90 backdrop-blur-sm shadow-xl border border-sakura/20 overflow-hidden min-h-[calc(100vh-38vh+5rem)]">
            <div class="p-5">
              <h2 class="text-2xl font-bold text-cocoa mb-4">
                {{ activeTab === 'schedule' ? 'ä»Šæ—¥è¡Œç¨‹' : activeTab + ' é é¢ï¼ˆé–‹ç™¼ä¸­ï¼‰' }}
              </h2>
              
              <!-- ç›®å‰å…ˆæ”¾è¡Œç¨‹ placeholder -->
              <div v-if="activeTab === 'schedule'" class="space-y-4">
                <div class="bg-sakura/5 rounded-2xl p-4 border border-sakura/30">
                  <div class="flex justify-between items-center">
                    <div>
                      <p class="font-bold text-lg">09:00 - 11:30</p>
                      <p class="text-cocoa/80">æ·ºè‰å¯º â†’ é›·é–€ â†’ ä»²è¦‹ä¸–é€šã‚Š</p>
                    </div>
                    <span class="px-3 py-1 bg-sakura/20 rounded-full text-sm">æ™¯é»</span>
                  </div>
                </div>
                <!-- æ›´å¤šå¡ç‰‡... -->
              </div>
            </div>
          </main>

          <FloatingTabs v-model:activeTab="activeTab" />
          
          <!-- é å°¾ debug -->
          <footer class="text-center text-cocoa/50 py-8 text-sm">
            ğŸŒ¸ Tiffany & Benjamin ğŸŒ¸
          </footer>
        </div>
      `
    };

    createApp(App).mount('#app');
  </script>

  <!-- PWA manifest ï¼ˆä¹‹å¾Œå¯ç¨ç«‹æª”æ¡ˆï¼‰ -->
  <script id="manifest">
    {
      "name": "æ—…éŠæ‰‹å¸³",
      "short_name": "Travel Diary",
      "start_url": ".",
      "display": "standalone",
      "background_color": "#FFF9E3",
      "theme_color": "#FFD1DC",
      "icons": [
        {
          "src": "assets/icon.png",
          "sizes": "192x192",
          "type": "image/png"
        }
      ]
    }
  </script>

</body>
</html>
