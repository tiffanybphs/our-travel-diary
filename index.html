<!DOCTYPE html>
<html lang="zh-TW" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>æ—…éŠæ‰‹å¸³ãƒ»Our Travel Diary</title>

  <!-- Google Font: Zen Maru Gothic -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@300;400;500;700&display=swap" rel="stylesheet">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['"Zen Maru Gothic"', 'sans-serif'] },
          colors: {
            'sakura': '#FFD1DC',
            'beige': '#FFF9E3',
            'aqua':  '#B0E0E6',
            'cocoa': '#8B7355',
          },
          borderRadius: { '4xl': '2.5rem', '5xl': '3rem' },
          boxShadow: {
            'paper': '6px 8px 20px rgba(139,115,85,0.12), -3px -3px 12px rgba(255,255,255,0.7)',
            'paper-hover': '10px 12px 30px rgba(139,115,85,0.18)',
          }
        }
      }
    }
  </script>

  <!-- Vue 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <!-- vue-draggable-next -->
  <script src="https://cdn.jsdelivr.net/npm/vue-draggable-next@2.2.1/dist/vuedraggable.umd.min.js"></script>
</head>
<body class="bg-beige min-h-screen text-cocoa antialiased font-sans">

  <div id="app" class="relative">

    <!-- Header -->
    <header class="relative h-[38vh] min-h-[260px] w-full overflow-hidden">
      <img 
        src="https://images.unsplash.com/photo-1558591710-4b4a1ae0f04d?ixlib=rb-4.0.3&auto=format&fit=crop&w=2340&q=80" 
        alt="æ«»èŠ±èƒŒæ™¯" 
        class="object-cover w-full h-full brightness-95"
      >
      <div class="absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-beige/70"></div>
      <div class="absolute bottom-8 left-0 right-0 text-center z-10">
        <h1 class="text-5xl font-bold text-white drop-shadow-lg">æ—…éŠæ‰‹å¸³</h1>
        <p class="text-white/90 mt-2 text-xl drop-shadow">èˆ‡æ«»èŠ±ä¸€èµ·è¨˜éŒ„æ—…ç¨‹</p>
      </div>
    </header>

    <!-- Main Content -->
    <main class="-mt-24 mx-4 md:mx-8 rounded-4xl bg-white/85 backdrop-blur-sm shadow-xl border border-sakura/20 overflow-hidden min-h-[60vh]">

      <div class="p-5 md:p-8">

        <ScheduleTab v-if="activeTab === 'schedule'" />
        <div v-else class="text-center py-32 text-cocoa/50 text-xl">
          è©²åŠŸèƒ½æ­£åœ¨é–‹ç™¼ä¸­ ğŸŒ¸
        </div>

      </div>
    </main>

    <!-- Floating â†’ Sticky Tabs -->
    <FloatingTabs v-model:activeTab="activeTab" />

    <!-- Footer -->
    <footer class="text-center text-cocoa/50 py-12 text-sm">
      ğŸŒ¸ Tiffany & Benjamin ğŸŒ¸
    </footer>

  </div>

  <script type="module">
    const { createApp, ref, computed, watch, onMounted } = Vue;

    // Header (ä¸è®Š)
    const Header = { template: '' }; // å·²ç§»åˆ° HTML

    // FloatingTabs
    const FloatingTabs = {
      props: ['activeTab'],
      emits: ['update:activeTab'],
      setup(props, { emit }) {
        const isSticky = ref(false);
        const tabs = ref([
          { id: 'schedule', label: 'è¡Œç¨‹', icon: 'calendar-days' },
          { id: 'map',      label: 'å°èˆª', icon: 'map-location' },
          { id: 'vouchers', label: 'æ†‘è­‰', icon: 'ticket' },
          { id: 'list',     label: 'æ¸…å–®', icon: 'list-check' },
          { id: 'expense',  label: 'è¨˜å¸³', icon: 'yen-sign' },
        ]);

        onMounted(() => {
          window.addEventListener('scroll', () => {
            isSticky.value = window.scrollY > window.innerHeight * 0.25;
          });
        });

        return {
          tabs,
          isSticky,
          activeTab: computed({
            get: () => props.activeTab,
            set: v => emit('update:activeTab', v)
          })
        };
      },
      template: `
        <nav :class="[
          'z-50 transition-all duration-300',
          isSticky 
            ? 'fixed top-0 left-0 right-0 bg-beige/95 backdrop-blur-md shadow-sm border-b border-sakura/30'
            : 'absolute -bottom-14 right-6 flex justify-end'
        ]">
          <div :class="[
            isSticky 
              ? 'flex w-full justify-around py-3 px-4'
              : 'inline-flex bg-white/85 backdrop-blur-lg rounded-full shadow-xl px-3 py-3 gap-2 border border-sakura/30'
          ]">
            <button v-for="tab in tabs" :key="tab.id"
              @click="activeTab = tab.id"
              :class="[
                'flex flex-col items-center px-4 py-1 rounded-xl transition-colors',
                activeTab === tab.id 
                  ? 'text-sakura bg-sakura/15' 
                  : 'text-cocoa/70 hover:text-sakura hover:bg-sakura/10'
              ]"
            >
              <i :class="'fa-solid fa-' + tab.icon + ' text-2xl mb-1'"></i>
              <span class="text-xs font-medium">{{ tab.label }}</span>
            </button>
          </div>
        </nav>
      `
    };

    // ScheduleTab â”€â”€ æ‰‹å¸³é¢¨ä¸»å…§å®¹
    const ScheduleTab = {
      components: { draggable: window.vuedraggable },
      setup() {
        const plansByDate = ref({});
        const tripStart = ref('2025-02-01');
        const tripEnd   = ref('2025-02-10');
        const currentDate = ref('2025-02-01');
        const showRangeSetting = ref(false);

        const totalDays = computed(() => {
          if (!tripStart.value || !tripEnd.value) return 0;
          return Math.floor((new Date(tripEnd.value) - new Date(tripStart.value)) / 86400000) + 1;
        });

        const dayNumber = computed(() => {
          if (!tripStart.value || !currentDate.value) return 0;
          return Math.floor((new Date(currentDate.value) - new Date(tripStart.value)) / 86400000) + 1;
        });

        const formattedDate = computed(() => {
          return new Date(currentDate.value).toLocaleDateString('zh-TW', {
            year: 'numeric', month: 'long', day: 'numeric', weekday: 'long'
          });
        });

        const dailyPlan = computed({
          get: () => plansByDate.value[currentDate.value] || [],
          set: v => { plansByDate.value[currentDate.value] = v; }
        });

        const initializeRange = () => {
          if (!tripStart.value || !tripEnd.value) return;
          let d = new Date(tripStart.value);
          const end = new Date(tripEnd.value);
          while (d <= end) {
            const key = d.toISOString().split('T')[0];
            if (!plansByDate.value[key]) plansByDate.value[key] = [];
            d.setDate(d.getDate() + 1);
          }
          if (currentDate.value < tripStart.value || currentDate.value > tripEnd.value) {
            currentDate.value = tripStart.value;
          }
        };

        watch([tripStart, tripEnd], initializeRange, { immediate: true });

        const getEndTime = (start, dur) => {
          if (!start) return '--:--';
          let [h,m] = start.split(':').map(Number);
          let t = h*60 + m + (dur||0);
          return `\( {Math.floor(t/60).toString().padStart(2,'0')}: \){(t%60).toString().padStart(2,'0')}`;
        };

        const updateTimes = () => {
          let t = null;
          dailyPlan.value.forEach((item,i) => {
            if (i===0) t = item.startTime || '09:00';
            else item.startTime = t;
            t = getEndTime(t, item.duration);
          });
        };

        watch(dailyPlan, updateTimes, { deep: true });
        watch(currentDate, updateTimes);

        const addItem = type => {
          const plan = dailyPlan.value;
          const lastEnd = plan.length 
            ? getEndTime(plan.at(-1).startTime, plan.at(-1).duration)
            : '09:00';

          plan.push({
            id: Date.now(),
            type,
            startTime: lastEnd,
            duration: type==='activity'?90:30,
            title: type==='activity'?'æ–°æ´»å‹•':'æ–°ç§»å‹•',
            location: '',
            note: '',
            transport: type==='transport' ? {from:'',to:''} : null
          });
        };

        const prevDay = () => {
          let d = new Date(currentDate.value);
          d.setDate(d.getDate()-1);
          let nd = d.toISOString().split('T')[0];
          if (nd >= tripStart.value) currentDate.value = nd;
        };

        const nextDay = () => {
          let d = new Date(currentDate.value);
          d.setDate(d.getDate()+1);
          let nd = d.toISOString().split('T')[0];
          if (nd <= tripEnd.value) currentDate.value = nd;
        };

        return {
          tripStart, tripEnd, totalDays, dayNumber, currentDate, formattedDate,
          dailyPlan, getEndTime, addItem, prevDay, nextDay, showRangeSetting
        };
      },
      template: `
        <div class="space-y-8">

          <!-- æ—…ç¨‹ç¯„åœè¨­å®šï¼ˆæ‰‹å¸³æ¨™ç±¤å¼ï¼‰ -->
          <div class="relative bg-white/80 rounded-3xl border border-sakura/30 shadow-paper overflow-hidden">
            <button @click="showRangeSetting = !showRangeSetting"
              class="w-full px-6 py-4 flex justify-between items-center hover:bg-sakura/5 transition">
              <div class="flex items-center gap-3">
                <i class="fa-solid fa-calendar-days text-sakura text-2xl"></i>
                <div>
                  <div class="font-bold text-lg">æ—…ç¨‹æœŸé–“</div>
                  <div class="text-sm text-cocoa/70">
                    {{ tripStart }} ï½ {{ tripEnd }} ãƒ»å…± {{ totalDays }} å¤©
                  </div>
                </div>
              </div>
              <i :class="showRangeSetting ? 'fa-chevron-up' : 'fa-chevron-down'" class="fa-solid"></i>
            </button>

            <div v-if="showRangeSetting" class="px-6 pb-6 pt-2 border-t border-sakura/20">
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
                <div>
                  <label class="block text-sm text-cocoa/70 mb-1">å‡ºç™¼æ—¥æœŸ</label>
                  <input v-model="tripStart" type="date" class="w-full px-4 py-3 border-2 border-sakura/30 rounded-2xl bg-white/60 focus:border-sakura focus:ring-2 focus:ring-sakura/30">
                </div>
                <div>
                  <label class="block text-sm text-cocoa/70 mb-1">æ­¸ä¾†æ—¥æœŸ</label>
                  <input v-model="tripEnd" type="date" :min="tripStart" class="w-full px-4 py-3 border-2 border-sakura/30 rounded-2xl bg-white/60 focus:border-sakura focus:ring-2 focus:ring-sakura/30">
                </div>
              </div>
              <p class="mt-4 text-center text-cocoa/70">ç›®å‰é¡¯ç¤ºï¼šç¬¬ {{ dayNumber }} å¤© / å…± {{ totalDays }} å¤©</p>
            </div>
          </div>

          <!-- Day é¡¯ç¤º â”€â”€ æ‰‹å¸³é¢¨ -->
          <div class="relative my-6 mx-auto max-w-2xl px-4">
            <div class="relative bg-gradient-to-br from-white via-beige/70 to-white/90 
                        rounded-3xl rounded-tr-[4rem] rounded-bl-[4rem]
                        border border-cocoa/10 border-t-2 border-l-2
                        shadow-paper overflow-hidden p-6 pt-8 pb-10">

              <div class="absolute -top-1 -left-1 w-16 h-16 bg-gradient-to-br from-cocoa/5 to-transparent rotate-[-12deg] opacity-40 pointer-events-none"></div>

              <div class="flex items-start justify-between gap-4 relative z-10">
                <button @click="prevDay" :disabled="currentDate <= tripStart"
                  class="mt-4 w-10 h-10 flex items-center justify-center rounded-full text-cocoa/50 hover:text-sakura hover:bg-sakura/5 disabled:opacity-30">
                  <i class="fa-solid fa-chevron-left text-xl"></i>
                </button>

                <div class="flex-1 text-center relative">
                  <div class="absolute -top-10 -right-4 text-sakura/40 text-6xl transform rotate-12 opacity-70 pointer-events-none">
                    <i class="fa-solid fa-flower-tulip"></i>
                  </div>
                  <div class="text-7xl md:text-8xl font-black text-sakura tracking-[-0.05em] leading-none drop-shadow-md -rotate-2">
                    Day {{ dayNumber }}
                  </div>
                  <div class="mt-3 text-lg md:text-xl text-cocoa/85 font-medium tracking-wide opacity-90 text-left pl-4 md:pl-8">
                    {{ formattedDate }}
                  </div>
                </div>

                <button @click="nextDay" :disabled="currentDate >= tripEnd"
                  class="mt-4 w-10 h-10 flex items-center justify-center rounded-full text-cocoa/50 hover:text-sakura hover:bg-sakura/5 disabled:opacity-30">
                  <i class="fa-solid fa-chevron-right text-xl"></i>
                </button>
              </div>

              <input v-model="currentDate" type="date" :min="tripStart" :max="tripEnd"
                class="mt-6 px-4 py-1.5 bg-white/40 border border-cocoa/20 rounded-xl text-sm text-cocoa/80 mx-auto block w-44 text-center shadow-inner opacity-70 hover:opacity-100 transition">
            </div>
          </div>

          <!-- æ–°å¢æŒ‰éˆ• -->
          <div class="flex flex-wrap justify-center gap-6 my-8">
            <button @click="addItem('activity')"
              class="px-8 py-3 bg-gradient-to-r from-sakura to-pink-300 text-white rounded-full shadow-lg hover:shadow-xl hover:scale-105 transition-all flex items-center gap-2 text-lg">
              <i class="fa-solid fa-plus"></i> æ–°å¢æ´»å‹•
            </button>
            <button @click="addItem('transport')"
              class="px-8 py-3 bg-gradient-to-r from-aqua to-cyan-300 text-white rounded-full shadow-lg hover:shadow-xl hover:scale-105 transition-all flex items-center gap-2 text-lg">
              <i class="fa-solid fa-route"></i> æ–°å¢ç§»å‹•
            </button>
          </div>

          <!-- è¡Œç¨‹å¡ç‰‡åˆ—è¡¨ -->
          <draggable v-model="dailyPlan" item-key="id" tag="div" class="space-y-6" handle=".drag-handle" animation="250">
            <template #item="{element}">
              <div class="relative group bg-gradient-to-br from-beige via-white/95 to-beige/80 
                          rounded-3xl rounded-tr-[3.5rem] rounded-bl-[4rem] 
                          border border-cocoa/8 border-t-2 border-l-2 
                          shadow-paper overflow-hidden transition-all duration-300 
                          hover:shadow-paper-hover hover:-translate-y-1">

                <div class="absolute -top-2 -left-2 w-20 h-20 bg-gradient-to-br from-sakura/20 to-transparent rotate-[-10deg] opacity-40 pointer-events-none"></div>

                <div class="drag-handle absolute -left-3 top-1/2 -translate-y-1/2 z-20 w-8 h-14 flex items-center justify-center cursor-move">
                  <div class="w-1.5 h-10 bg-cocoa/30 rounded-full shadow-inner"></div>
                </div>

                <div class="pl-10 pr-5 pt-5 pb-6 relative">
                  <div class="flex items-baseline gap-3 mb-3">
                    <div class="text-4xl font-black text-sakura tracking-tight drop-shadow-sm -rotate-2">
                      {{ element.startTime }}
                    </div>
                    <div class="text-xl text-cocoa/60">â†’</div>
                    <div class="text-2xl font-bold text-cocoa/90">
                      {{ getEndTime(element.startTime, element.duration) }}
                    </div>
                    <div class="ml-auto px-3 py-1 bg-sakura/15 rounded-full text-sm font-medium text-sakura border border-sakura/30 shadow-sm rotate-2">
                      {{ element.duration }} åˆ†
                    </div>
                  </div>

                  <div class="flex items-center gap-3 mb-2">
                    <span class="px-4 py-1 text-sm font-medium rounded-full shadow-sm"
                      :class="element.type==='activity'?'bg-sakura/20 text-sakura border-sakura/40':'bg-aqua/20 text-aqua border-aqua/40'">
                      {{ element.type==='activity'?'æ´»å‹•':'ç§»å‹•' }}
                    </span>
                    <h3 class="text-xl md:text-2xl font-bold text-cocoa tracking-wide pl-2 border-l-4 border-sakura/40">
                      {{ element.title }}
                    </h3>
                  </div>

                  <p class="text-cocoa/85 mb-3 pl-2 border-l border-cocoa/20 text-lg">
                    {{ element.location || 'åœ°é»å¾…å¡«' }}
                  </p>

                  <div v-if="element.type==='transport' && element.transport" class="mb-4 p-3 bg-white/50 rounded-2xl border border-cocoa/10 text-sm">
                    <div class="flex items-center gap-2">
                      <i class="fa-solid fa-location-dot text-aqua text-lg"></i>
                      <span>{{ element.transport.from || 'èµ·é»' }}</span>
                      <i class="fa-solid fa-arrow-right-long text-cocoa/50 mx-1"></i>
                      <span>{{ element.transport.to || 'çµ‚é»' }}</span>
                    </div>
                  </div>

                  <div class="flex items-center gap-4 text-sm mb-4">
                    <label class="text-cocoa/70 whitespace-nowrap">æŒçºŒï¼š</label>
                    <input v-model.number="element.duration" type="number" min="5" step="5"
                      class="w-20 px-3 py-1.5 bg-white/60 border border-cocoa/20 rounded-xl text-center focus:outline-none focus:border-sakura/60 shadow-inner">
                    <span class="text-cocoa/70">åˆ†é˜</span>
                  </div>

                  <textarea v-model="element.note" placeholder="æ‰‹å¸³ç­†è¨˜ / æé†’ / å°æ„Ÿæƒ³..."
                    class="w-full px-4 py-3 text-base bg-white/40 border border-dashed border-cocoa/30 rounded-2xl focus:outline-none focus:border-sakura/50 resize-y min-h-[80px] shadow-inner"></textarea>

                  <div class="absolute bottom-2 right-4 text-sakura/30 text-5xl transform rotate-12 opacity-60 pointer-events-none group-hover:opacity-80 transition-opacity">
                    <i class="fa-solid fa-flower-tulip"></i>
                  </div>
                </div>
              </div>
            </template>
          </draggable>

          <div v-if="!dailyPlan.length" class="text-center py-16 text-cocoa/50 bg-white/40 rounded-3xl border border-dashed border-cocoa/20">
            ç¬¬ {{ dayNumber }} å¤© é‚„æ²’æœ‰ä»»ä½•è¡Œç¨‹ï½<br>å¿«ä¾†æ–°å¢å§ ğŸŒ¸
          </div>

        </div>
      `
    };

    // App
    const App = {
      components: { FloatingTabs, ScheduleTab },
      setup() {
        const activeTab = ref('schedule');
        return { activeTab };
      },
      template: `<div class="pb-32"><FloatingTabs v-model:activeTab="activeTab" /></div>`
    };

    createApp(App).mount('#app');
  </script>

</body>
</html>
